<div class="container">
  <div
    class="main-content"
    *ngIf="(id_rol === 2 && permission) || (id_rol === 1 && permission)"
  >
    <div
      *ngFor="let contenido of contenidoDeCurso; let i = index"
      class="section"
    >
      <h2>Seccion {{ i + 1 }}: {{ contenido.nombre_seccion_contenido }}</h2>
      <p>{{ contenido.descripcion_contenido }}</p>

      <div class="content-items">
        <div class="content-item">
          <ng-container *ngIf="contenido.imagen_contenido">
            <img
              [src]="getPortadaBase64(contenido.imagen_contenido)"
              alt="Image"
              class="course-image"
            />
          </ng-container>
          <ng-container *ngIf="contenido.url_video_contenido">
            <iframe
              width="100%"
              height="500"
              [src]="
                generarEnlaceIncrustadoYouTube(contenido.url_video_contenido)
              "
              title="YouTube video player"
              frameborder="0"
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
              referrerpolicy="strict-origin-when-cross-origin"
              allowfullscreen
            ></iframe>
          </ng-container>
          <ng-container *ngIf="contenido.texto_contenido">
            <h3>{{ contenido.texto_contenido }}</h3>
          </ng-container>
        </div>
      </div>
    </div>

    <div class="section center-button" *ngIf="id_rol === 2 && permission">
      <p-button
        (click)="showDialog()"
        label="Agregar mÃ¡s contenido"
        icon="pi pi-plus-circle"
        iconPos="right"
        severity="contrast"
      ></p-button>

      <p-dialog
        header="Crear Contenido"
        [modal]="true"
        [(visible)]="visible"
        [style]="{ maxWidth: '100%', width: '34rem' }"
        [contentStyle]="{ overflow: 'auto' }"
      >
        <span class="p-text-secondary block mb-5">Llena los campos</span>
        <form
          [formGroup]="crearContenidoForm"
          (ngSubmit)="emitDataForCreateContent()"
        >
          <div class="flex align-items-center gap-3 mb-3">
            <label class="font-semibold w-6rem">Nombre de esta seccion:</label>
            <input
              pInputText
              formControlName="nombre_seccion_contenido"
              id="url-video"
              class="flex-auto"
              autocomplete="off"
            />
            <div
              *ngIf="crearContenidoForm.controls['nombre_seccion_contenido'].errors?.['required'] && formSubmitted"
            >
              <small style="color: red"> Este campo es obligatorio </small>
            </div>
          </div>
          <div class="flex align-items-center gap-3 mb-3">
            <label class="font-semibold w-6rem"
              >Descripcion del contenido:</label
            >
            <textarea
              rows="5"
              cols="60"
              pInputTextarea
              formControlName="descripcion_contenido"
            >
            </textarea>
            <div
              *ngIf="crearContenidoForm.controls['descripcion_contenido'].errors?.['required'] && formSubmitted"
            >
              <small style="color: red"> Este campo es obligatorio </small>
            </div>
          </div>
          <div class="flex align-items-center gap-3 mb-3">
            <label class="font-semibold w-6rem">Opciones:</label>
            <p-treeSelect
              class="w-full text-black-alpha-90"
              containerStyleClass="w-full"
              [options]="tiposContenido"
              placeholder="Selecciona tipo de contenido"
              formControlName="id_categoria"
              [(ngModel)]="opcionSeleccionada"
            />
            <div
              *ngIf="crearContenidoForm.controls['id_categoria'].errors?.['required'] && formSubmitted"
            >
              <small style="color: red"> Este campo es obligatorio </small>
            </div>
          </div>

          <div
            *ngIf="opcionSeleccionada?.data === 2"
            class="flex align-items-center gap-3 mb-3"
          >
            <label class="font-semibold w-6rem">URL de video:</label>
            <input
              pInputText
              formControlName="url_video"
              id="url-video"
              class="flex-auto"
              autocomplete="off"
            />
          </div>

          <div
            *ngIf="opcionSeleccionada?.data === 3"
            class="flex align-items-center gap-3 mb-3"
          >
            <label class="font-semibold w-6rem">Texto:</label>
            <input
              pInputText
              formControlName="texto"
              id="texto"
              class="flex-auto"
              autocomplete="off"
            />
          </div>

          <div
            *ngIf="opcionSeleccionada?.data === 1"
            class="flex align-items-center gap-3 mb-5"
          >
            <label class="font-semibold w-6rem">Selecciona la imagen</label>
            <div class="file-upload-container">
              <p-fileUpload
                mode="basic"
                chooseLabel="Elegir imagen"
                chooseIcon="pi pi-upload"
                name="portada_curso"
                url="http://localhost:3000/api/cursos/upload/image/"
                accept="image/*"
                maxFileSize="1000000"
                (onUpload)="onUpload($event)"
                [style]="{ width: '23.8rem' }"
                [auto]="true"
              ></p-fileUpload>
              <div *ngIf="archivoSubidoNombre" class="uploaded-file-name">
                {{ archivoSubidoNombre }}
              </div>
            </div>
          </div>
          <div
            *ngIf="!opcionSeleccionada"
            class="flex align-items-center gap-3 mb-5"
          >
            <p>Debes seleccionar un contenido</p>
          </div>
          <div *ngIf="errorMessage && formSubmitted">
            <small style="color: red"> Este campo es obligatorio </small>
          </div>
          <div class="flex justify-content-end gap-2">
            <p-button
              label="Cancelar"
              severity="secondary"
              (click)="visible = false"
            ></p-button>
            <p-button label="Guardar" type="Submit"></p-button>
          </div>
        </form>
      </p-dialog>
    </div>
  </div>

  <div class="main-content" *ngIf="id_rol === 2 && !permission">
    <div class="section">
      <h1>
        Debes tener una cuenta de estudiante para ver el contenido de este curso
      </h1>
    </div>
  </div>

  <div class="main-content" *ngIf="id_rol === 1 && !permission">
    <div class="section">
      <h1>Debes comprar este curso para ver su contenido</h1>
    </div>
    <div class="section center-button">
      <p-confirmDialog></p-confirmDialog>
      <p-button
        (click)="comprarCurso($event)"
        label="Comprar por {{ curso.precio_curso }}"
        icon="pi pi-dollar"
        iconPos="right"
        severity="contrast"
      ></p-button>
    </div>
  </div>

  <div class="sidebar">
    <h3>Contenido del Curso</h3>
    <ul>
      <li *ngFor="let contenido of contenidoDeCurso; let i = index">
        <p>Seccion {{ i + 1 }}: {{ contenido.nombre_seccion_contenido }}</p>
      </li>
    </ul>
  </div>
</div>
<p-button
  *ngIf="
    (id_rol === 1 && permission && curso.con_certificacion) ||
    (id_rol === 2 && permission && curso.con_certificacion)
  "
  styleClass="mt-4"
  icon="pi pi-iconName"
  label="Generar certificado"
  (onClick)="generarCertificado()"
></p-button>
